# RC522-changeidesp32

使用 ESP32S3 和 MFRC522 RFID 讀卡模組修改CUID卡片(gen 2魔術卡)的卡號。

## 硬體需求

* ESP32S3 開發板
* MFRC522 RFID模組
* CUID卡（gen2魔術卡）
* 用於連接的杜邦線

## 腳位連接

| ESP32S3 腳位 | MFRC522 腳位 |
| ---------- | ---------- |
| 4          | RST        |
| 5          | SDA (SS)   |
| 16         | MISO       |
| 17         | SCK        |
| 18         | MOSI       |
| 3.3V       | 3.3V       |
| GND        | GND        |

## 功能特色

* 讀取卡片的原始 UID
* 將預設的新 UID 寫入卡片
* 在寫入前驗證卡片是否為可修改類型
* 防止重複寫入同一張卡片（卡片必須取出後才能再處理）
* 透過序列埠監控器提供明確的使用者回饋

## 設定方式

若要自訂要寫入卡片的新 UID，請修改程式碼中的 `newUid` 陣列：

```cpp
// 替換為你想要的 UID
byte newUid[] = {0x12, 0x34, 0x56, 0x69};
```

## 安裝步驟

1. 安裝 Arduino IDE
2. 安裝 ESP32 板子套件：

   * 在 Arduino IDE 中，前往 `檔案 > 偏好設定`
   * 在「額外的開發板管理員網址」欄位中加入：
     `https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json`
   * 接著前往 `工具 > 開發板 > 開發板管理員`
   * 搜尋「esp32」並安裝 ESP32 套件
3. 安裝 MFRC522 函式庫：

   * 前往 `Sketch > 程式庫 > 管理程式庫`
   * 搜尋「MFRC522」並安裝 Miguel Balboa 的函式庫
4. 下載此專案的[app.ino範例程式](https://github.com/green-mochi/RC522_change_uid/blob/main/app.ino)並上傳至 ESP32S3 開發板
5. 開啟序列埠監控器（鮑率設定為 9600），觀察程式輸出結果

## 使用方式

1. 依照「腳位連接」章節說明接好硬體
2. 將程式上傳至 ESP32S3
3. 開啟序列埠監控器（設定鮑率為 9600）
4. 將符合條件的 RFID 卡放到讀卡器上
5. 程式會讀取原始 UID 並嘗試寫入新 UID
6. 若成功，會顯示「UID 寫入成功！」
7. 寫入完成後，請將卡片完全移除後再放入其他卡片

## 原理說明

程式進行以下操作：

1. 初始化 MFRC522 RFID 讀卡器，並準備預設金鑰進行認證
2. 持續檢查是否有 RFID 卡片接近
3. 偵測到卡片時，讀取目前的 UID
4. 確認該卡是否為新的卡片，避免重複寫入
5. 若為新卡，則嘗試將新 UID 寫入第 0 區塊
6. 記錄卡片狀態以確保處理流程正確
7. 透過序列埠監控器提供使用者操作回饋

## 疑難排解

* **找不到卡片**：請確認連線正確並確認卡片為相容類型
* **寫入失敗**：並非所有卡片都支援修改 UID，僅有第二代 / Magic 卡通常可改
* **重複處理同一張卡**：此程式設計會避免這種情況，請務必將卡片完全移開再重新放入
* **通訊錯誤**：若頻繁出現通訊問題，請嘗試重置 ESP32 板子

## 警告

修改卡片 UID 在某些地區可能違法，或違反某些系統的使用條款。本程式僅供教育用途，請負責任並遵守當地法律與道德規範使用。

## 致謝

本專案基於 [MFRC522](https://github.com/miguelbalboa/rfid) 函式庫範例，並針對 ESP32S3 與特定卡片處理邏輯進行修改。
